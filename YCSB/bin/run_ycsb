#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )/.."

if [ $# -ne 1 ]; then
    echo "Usage: $0 workload_file"
    exit 1
fi

WORKLOAD="$(realpath "$1")"

cd "$DIR/.."
mvn test-compile exec:java -Dexec.mainClass=server.YCSBSetup -Dexec.classpathScope=test > "$DIR/proxy.log" &
bg_pid=$!

cd "$DIR"
./bin/ycsb load jdbc -P "$WORKLOAD" -P jdbc/src/main/conf/db.properties -cp ./h2-latest.jar
rv=$!

kill -INT $bg_pid
exit $rv

